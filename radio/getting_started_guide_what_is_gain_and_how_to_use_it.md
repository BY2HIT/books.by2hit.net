# 通信入门科普--什么是增益(Gain)，为什么常用dB作为单位，如何做简单通信链路计算

#### <p align="right"> 作者：BG2CCF</p>

> 注：本篇文章仅用作科普，部分内容可能表述不严谨。

## 0x00 一个选购对讲机的问题

我们来考虑一个实际的计算问题：传说中的小明想买一副对讲机和传说中的小红聊天，假设小明在哈尔滨工业大学一校区的主楼楼顶，小红在哈工大二校区主楼楼顶，直线距离4km，中间无障碍物。在选购对讲机时，卖家提供了如下参数：
* 发射功率：2W、3W、5W
* 工作频段：可选UHF频段（430MHz）或者VHF频段（145MHz）
* 天线：均为胶棒全向天线，天线增益为2dB
* 接收灵敏度： -80dBm

那么，应该如何选配，才能实现二者之间的通信呢？

## 0x01 关于增益，还有它的单位：dB

同样先来考虑一个小问题：
有如下的一个激光通信系统：

```
信号源 --> 障碍1 --> 障碍2 --> 接收器
```

其中，信号源发射功率为5W，障碍1、2均为半透射镜片，分别只能通过20%和30%的能量，那么，接收器能收到的信号功率是多少呢？

这个计算很简单，答案就是 `5W * 20% * 30% = 0.3W`

这个系统比较简单，如果中间经过的环节变得很多，计算一大堆乘法就不是那么容易了。那么，有没有办法用简单的加法来代替乘法呢？让我们把等号两边同时取log，于是变成了：

`log(5) + log(0.2) + log(0.3) = log(0.3)`

所以，我们可以引入一套新的约定：大家不要用具体的功率和衰减系数直接运算，而是统一用取对数之后的值来表示，这样，运算就会简单很多。

> 注意：计算加法比计算乘法简单是使用对数的原因之一，还有更主要的原因是很多物理规律以对数形式展示会更加简洁（比如下文要提到的`自由空间损耗`，为了给大家一个直观的认识，本文从加法运算比乘法运算简单的角度来介绍）

好了，上面的公式只是一个大概的思路，但和业界通用的做法还差一点，下面我们来看看业界的做法：

首先，介绍几个单位：

### dB: 
一个表征相对值的单位，是两个功率的比值取对数然后乘以10,或者两个电压的比值取对数后乘以20，也可以是两个电流的比值取对数后乘以20。
为什么有的是乘10，有的是乘20呢，下面的公式可以清楚解释这个问题：

<center>$$\frac{P_{1}}{P_{2}} = \frac{I_{1}^{2}R}{I_{2}^{2}R} = \frac{\frac{U_{1}^{2}}{R}}{\frac{U_{2}^{2}}{R}} = \frac{I_{1}^{2}}{I_{2}^{2}} = \frac{U_{1}^{2}}{U_{2}^{2}}$$</center>

所以，显然：

<center>$$\log\left(\frac{P_{1}}{P_{2}}\right) = 2*\log\left(\frac{I_{1}}{I_{2}}\right) = 2*\log\left(\frac{U_{1}}{U_{2}}\right)$$</center>

即，功率比与电压、电流比差一个系数2。

#### dB作为单位的增益特点：
* 若输出功率小于输入功率，则增益为负值，即信号被衰减
* 若输出功率大于输入功率，则增益为正值，即信号被放大


### dBm： 

一个表征功率绝对值的单位，以1毫瓦为基准单位，即某个功率与1mW的比值取log后乘以10。

例如，对于5W的功率，以dBm表示，则为

<center>$$5W = 5000mW = 10*\log\left(\frac{5000mW}{1mW}\right) \approx 36.9dBm$$</center>

## 0x02 自由空间损耗的计算

如同距离灯泡越远就越暗一样，从天线发射出的电磁波在传播过程中会不断衰减。

现在我们考虑理想环境下的衰减计算（空间无限大，无障碍，1个标准大气压，25摄氏度气温），这个衰减主要受到以下几方面的影响：

* 距离： 距离越远则衰减越大
* 频率： 频率越高，衰减越块

最终的衰减计算公式如下：

<center>$$Loss=32.5 + 20\log(F) + 20\log(D)$$</center>

其中：
* Loss: 衰减值，单位dB
* F: 信号频率，单位MHz
* D: 发射端与接收端的距离，单位km


# 0x03 在增益的表达方式下进行链路计算

一个系统的增益(Gain)，通常是基于系统输出功率与输入功率的比值计算的， 即：

<center>$$Gain=10\log\left(\frac{P_{out}}{P_{in}}\right)$$</center>


当几个子系统串联起来以后，前一个子系统的输出功率就是后一个子系统的输入功率，即：
<center>$$P_{1out}=P_{2in} \ \ \ \  P_{2out}=P_{3in} \ \ \ \  P_{3out}=P_{4in}\ \ \ ...$$</center>

因此，几个子系统串联起来后，最后一个子系统的输出功率和第一个子系统的输入功率之间的关系是：
<center>$$P_{3out}=P_{1in}*\frac{P_{1out}}{P_{1in}} \frac{P_{2out}}{P_{2in}} \frac{P_{3out}}{P_{3in}}$$</center>
对上面的公式变形，取对数，再调整系数，就得到了
<center>
\begin{align} 10\log\left(\frac{P_{3out}}{P_{1in}}\right) & = 10\log\left(\frac{P_{1out}}{P_{1in}} \frac{P_{2out}}{P_{2in}} \frac{P_{3out}}{P_{3in}}\right) \\ & = 10\log\left(\frac{P_{1out}}{P_{1in}}\right) + 10\log\left(\frac{P_{2out}}{P_{2in}}\right) + 10\log\left(\frac{P_{3out}}{P_{3in}}\right) \end{align}
</center>
即：
<center>$$Gain_{all}=Gain_{1}+Gain_{2}+Gain_{3}$$</center>
可见，在用dB为单位进行表示的情况下，由几个子系统串联起来的整体系统的增益，等于各个子系统各自增益的代数和。

# 0x04 回到对讲机问题

现在，回到我们最初的对讲机问题。实际上，从发射到接受，可以抽象成下面的系统：
```
发射电路-->发射天线-->空气-->接受天线-->接收电路
```
中间的每一个环节（天线、空气），都可以看做一个子系统，而发射电路和接受电路分别是整个系统的输入和输出。

我们选择3W发射功率，145MHz频率的对讲机为例：

发射电路，产生的信号功率为3W，经过计算，$$P_{source}=3W=10\log\left(\frac{3000}{1}\right)dBm\approx34.7dBm$$

发射天线从发射电路获取能量并传递到空气中，把天线作为一个系统，根据买家给出的参数，天线会引入$$G_{ant1}=2dB$$的增益

再看空气，经过传播，4km的距离，145MHz的频率，引入的衰减为：

$$Loss=32.5 + 20\log(145) + 20\log(4) \approx 60.1dB$$

注意，这个值时衰减，所以计算出来的结果应该取负值，即传播过程的增益是$$G_{air}=-60.1dB$$

对于接收天线来讲，引入$$G_{ant2}=2dB$$的增益。

此外，由于天线与对讲机的连接是通过SMA接头连接的，在连接器部位也会引入一定的信号衰减（所以，在实际使用中，尽量避免不必要的射频转换头），假设这部分衰减对应的增益为$$G_{conn}=-6dB$$

还要考虑到，我们刚才计算的空气传播损耗是假设在理想的自由空间里，实际上，在传播过程中，有大地、建筑物等存在，也会引入一些额外的环境损耗，我们假设这部分环境损耗为$$G_{env}=-20dB$$

> 注意，上述$$G_{conn}$$和$$G_{env}$$为假想值，实际中可以查阅相关资料，获取对应的经验数值。或通过仿真实验得到参考数值。

则最终接受电路获得到的信号功率为：

$$P_{recv}=P_{source} + G_{ant1} + G_{air} + G_{ant2} + G_{conn} + G_{env} = -47.4dBm$$


#### 最后我们来看一下接收机的接收灵敏度概念。

接收机的灵敏度，指接收机能够接收的最弱的信号是多少。本文开头，我们设定接收机的灵敏度为-80dBm, 根据上文计算出的结果，我们知道接收电路收到的信号功率为-47.4dBm，也就是说，接收机接收到的信号比其能处理的最小信号要强。其中，$$(-47.4dBm) - (-80dBm) = 32.6dBm$$称作这条通信链路的`裕量`，通常，裕量大于20dB时，接收机可以稳定的工作，而裕量较小时，也就是接收到的信号强度距离接收机的极限灵敏度很近时，接收机虽然能工作，但信号质量可能不好，也就是说接收机可能无法稳定工作（比如，收音机可能会有噪声）。

以上计算，是在频率为145MHz时计算的，如果将通信频率改为430MHz,则上述计算中的Loss将变为：
$$Loss=32.5 + 20\log(430) + 20\log(4) \approx 97.2dB$$

此时，接收机收到的信号将变为：

$$P_{recv}=P_{source} + G_{ant1} + G_{air} + G_{ant2} + G_{conn} + G_{env} = -84.5dBm$$

该数值小于接收机的接收灵敏度，因此，在该频段下，无法完成通信。

# 0x05 总结

这篇文章告诉我们，计算一个无线通信系统是否能工作，需要考虑：
* 发射机功率
* 天线增益
* 工作频段
* 传输距离
* 环境损耗
* 接收机灵敏度
